events{
    worker_connections 1024;
}

http{
    include /etc/nginx/mime.types;
    sendfile on;

    upstream XCloneAPI {
        least_conn;
        server apiserver1:80;
        server apiserver2:80;
        server apiserver3:80;
    }

    upstream XCloneWebApp {
        least_conn;
        server webappserver1:80;
        server webappserver2:80;
        server webappserver3:80;
    }

    server {
        
        listen 80;

        location ^~ /api/v1/ {
            proxy_pass http://XCloneAPI/api/v1;
        }

        location / {
            proxy_pass http://XCloneWebApp;

            root /usr/share/nginx/html;
            index index.html;
            try_files $uri /index.html;
        }
    }

}